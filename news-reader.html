<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>HandyHut - News Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    html { scroll-behavior: smooth; }
    #back-to-top {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #8B5CF6;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }
    #back-to-top:hover { opacity: 1; }
    .article-card { border-bottom: 1px solid #4B5563; margin-bottom: 1rem; padding-bottom: 1rem; }
    .article-header { cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .article-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; padding-top: 0.5rem; }
    .article-content.open { max-height: 500px; }
    #full-article-popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      overflow: auto;
      z-index: 1000;
      padding: 2rem;
    }
    #full-article-popup .article-content {
      max-height: none;
      word-wrap: break-word;
      max-width: 60ch;
      margin: 0 auto;
      font-size: 1.25rem;
      line-height: 1.6;
    }
    #close-popup-btn { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; cursor: pointer; color: white; }
    #view-full-article-btn {
      background-color: #6D28D9;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      cursor: pointer;
      margin-top: 0.5rem;
      display: inline-block;
    }
    #font-controls { position: absolute; bottom: 1rem; right: 1rem; display: flex; gap: 0.5rem; }
    #font-controls button {
      background-color: #4B5563;
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      border-radius: 0.25rem;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
  <div id="header-container"></div>
  <main class="container mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <h1 class="text-2xl font-bold text-indigo-400 mb-4">üóûÔ∏è News Reader</h1>
    <div class="mb-6 flex flex-wrap gap-4 items-center">
      <label class="block">
        <span class="text-sm text-gray-300">Category</span><br />
        <select id="category" class="bg-gray-800 border border-gray-600 p-2 rounded text-white" onchange="onCategoryChange()">
          <option value="toi">Times of India</option>
        </select>
      </label>
      <label class="block">
        <span class="text-sm text-gray-300">Subcategory</span><br />
        <select id="subcategory" class="bg-gray-800 border border-gray-600 p-2 rounded text-white" onchange="onFeedSelect()">
          <option value="top">Top Stories</option>
          <option value="india">India</option>
        </select>
      </label>
    </div>
    <p class="text-md text-yellow-200 mb-4 font-semibold">Click on the news article headlines below to read the complete news content.</p>
    <section class="bg-gray-800 p-4 rounded-md shadow-md">
      <h2 class="text-lg text-yellow-400 font-semibold mb-2">Articles</h2>
      <div id="news-list" class="space-y-4 text-sm"></div>
    </section>
    <div id="back-to-top" onclick="goToTop()">Back to Top</div>
  </main>
  <div id="footer-container"></div>
  <div id="full-article-popup">
    <span id="close-popup-btn" onclick="closeFullArticlePopup()">√ó</span>
    <div class="article-content"></div>
    <div class="mt-6 flex flex-col gap-3 items-center">
      <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded w-full max-w-md" onclick="summarizeArticle()">üìù Summarize</button>
      <button class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded w-full max-w-md" onclick="speakArticle()">üîä Listen</button>
      <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded w-full max-w-md" onclick="extractGlossary()">üìö Glossary</button>
    </div>
    <div id="ai-response" class="mt-4 text-sm text-gray-200 whitespace-pre-wrap"></div>
    <div id="font-controls">
      <button onclick="adjustFontSize(1)">+</button>
      <button onclick="adjustFontSize(-1)">-</button>
    </div>
  </div>
  <script>
    const openRouterAPIKey = "your_openrouter_api_key_here";
    const openRouterAPIBase = "https://openrouter.ai/api/v1/chat/completions";

    async function callOpenRouter(prompt, model = "mistralai/mistral-7b-instruct") {
      const responseBox = document.getElementById('ai-response');
      responseBox.innerText = "‚è≥ Processing...";
      try {
        const res = await fetch(openRouterAPIBase, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${openRouterAPIKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: model,
            messages: [{ role: "user", content: prompt }],
            max_tokens: 600,
            temperature: 0.5
          })
        });
        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content || "No response.";
        responseBox.innerText = reply;
      } catch (err) {
        responseBox.innerText = "‚ö†Ô∏è Error: " + err.message;
      }
    }

    function summarizeArticle() {
      const article = document.querySelector('#full-article-popup .article-content').innerText;
      callOpenRouter("Summarize this news article:\n" + article);
    }

    function extractGlossary() {
      const article = document.querySelector('#full-article-popup .article-content').innerText;
      callOpenRouter("Extract and explain glossary terms from this article:\n" + article);
    }

    async function speakArticle() {
      const article = document.querySelector('#full-article-popup .article-content').innerText.slice(0, 3000);
      const responseBox = document.getElementById('ai-response');
      responseBox.innerText = "‚è≥ Generating audio...";
      try {
        const res = await fetch("https://openrouter.ai/api/v1/audio/speech", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${openRouterAPIKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "openai/tts-1",
            input: article,
            voice: "nova"
          })
        });
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const audio = new Audio(url);
        audio.play();
        responseBox.innerText = "‚ñ∂Ô∏è Playing audio...";
      } catch (err) {
        responseBox.innerText = "‚ö†Ô∏è Audio Error: " + err.message;
      }
    }
  </script>
</body>
</html>
