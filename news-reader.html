<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>HandyHut - News Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    html { scroll-behavior: smooth; }
    .controls button {
      @apply px-2 py-1 bg-indigo-600 text-white rounded text-xs hover:bg-indigo-700;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">

<div id="header-container"></div>

<main class="container mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <h1 class="text-2xl font-bold text-indigo-400 mb-4">üóûÔ∏è News Reader</h1>

  <!-- Filter Controls -->
  <div class="mb-6 flex flex-wrap gap-4 items-center">
    <label class="block">
      <span class="text-sm text-gray-300">Category</span><br />
      <select id="category" class="bg-gray-800 border border-gray-600 p-2 rounded text-white" onchange="onCategoryChange()">
        <option value="toi">Times of India</option>
      </select>
    </label>

    <label class="block">
      <span class="text-sm text-gray-300">Subcategory</span><br />
      <select id="subcategory" class="bg-gray-800 border border-gray-600 p-2 rounded text-white" onchange="onFeedSelect()">
        <option value="top">Top Stories</option>
        <option value="india">India</option>
      </select>
    </label>
  </div>

  <!-- Two-column layout -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Left: Article Descriptions -->
    <section class="bg-gray-800 p-4 rounded-md shadow-md max-h-[75vh] overflow-y-auto">
      <h2 class="text-lg text-yellow-400 font-semibold mb-2">Articles</h2>
      <div id="news-list" class="space-y-4 text-sm"></div>
    </section>

    <!-- Right: Full Article + Reader -->
    <section class="bg-gray-800 p-4 rounded-md shadow-md max-h-[75vh] overflow-y-auto relative">
      <h2 class="text-lg text-indigo-400 font-semibold mb-2">Full Article</h2>

      <!-- Controls -->
      <div class="flex justify-between items-center mb-4">
        <div class="text-sm text-gray-400">Font size:
          <button onclick="changeFontSize(+1)">A+</button>
          <button onclick="changeFontSize(-1)">A‚àí</button>
        </div>
        <div class="text-sm text-gray-400 space-x-2">
          <button onclick="toggleView()">üîÅ Toggle View</button>
          <button onclick="prevSentence()">‚óÄ Prev</button>
          <button onclick="nextSentence()">Next ‚ñ∂</button>
        </div>
      </div>

      <!-- Full View -->
      <div id="full-article" class="text-gray-300 text-sm whitespace-pre-line mb-4"></div>

      <!-- Sentence View -->
      <div id="sentence-view" class="text-gray-100 text-sm bg-gray-700 p-3 rounded hidden"></div>
    </section>
  </div>
</main>

<div id="footer-container"></div>

<script>
  async function loadHeader() {
    const response = await fetch('header.html');
    document.getElementById('header-container').innerHTML = await response.text();
  }

  async function loadFooter() {
    const response = await fetch('footer.html');
    document.getElementById('footer-container').innerHTML = await response.text();
  }

  loadHeader();
  loadFooter();

  const feeds = {
    toi: {
      top: "http://timesofindia.indiatimes.com/rssfeedstopstories.cms",
      india: "http://timesofindia.indiatimes.com/rssfeeds/-2128936835.cms"
    }
  };

  const proxyBase = "https://api.codetabs.com/v1/proxy/?quest=";
  let sentenceIndex = 0;
  let allSentences = [];
  let fontSize = 16;
  let isSentenceMode = false;

  function onCategoryChange() {
    onFeedSelect();
  }

  function onFeedSelect() {
    const category = document.getElementById("category").value;
    const subcategory = document.getElementById("subcategory").value;
    const url = feeds[category][subcategory];
    const proxyURL = proxyBase + encodeURIComponent(url);

    fetch(proxyURL)
      .then(res => res.text())
      .then(text => {
        const xml = new DOMParser().parseFromString(text, "text/xml");
        const items = xml.querySelectorAll("item");
        const list = document.getElementById("news-list");
        list.innerHTML = "";
        document.getElementById("full-article").innerHTML = "Select an article to read.";
        document.getElementById("sentence-view").innerHTML = "";

        items.forEach((item) => {
          const title = item.querySelector("title").textContent;
          const link = item.querySelector("link").textContent;
          const description = item.querySelector("description").textContent;

          const card = document.createElement("div");
          card.className = "p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600";
          card.innerHTML = `<strong class="text-indigo-300">${title}</strong><p class="text-gray-400 mt-1">${description}</p>`;
          card.onclick = () => loadFullArticle(link, title);
          list.appendChild(card);
        });
      })
      .catch(err => {
        console.error("RSS feed load error:", err);
        document.getElementById("news-list").innerHTML = `<p class="text-red-400">Failed to load news.</p>`;
      });
  }

  function loadFullArticle(url, title) {
    const proxyURL = proxyBase + encodeURIComponent(url);

    fetch(proxyURL)
      .then(res => res.text())
      .then(html => {
        const doc = new DOMParser().parseFromString(html, "text/html");
        const mainDiv = doc.querySelector("div._s30J.clearfix");
        const textContent = mainDiv ? mainDiv.innerText.trim() : "Unable to extract main content.";

        allSentences = textContent.match(/[^\.!\?]+[\.!\?]+/g) || [textContent];
        sentenceIndex = 0;

        document.getElementById("full-article").innerHTML = `<h3 class="text-indigo-300 font-semibold mb-2">${title}</h3><p>${textContent}</p>`;
        document.getElementById("sentence-view").innerText = allSentences[0];
        applyFontSize();
        toggleView(false); // Reset to full view when article loads
      })
      .catch(err => {
        console.error("Full article load error:", err);
        document.getElementById("full-article").innerHTML = `<p class="text-red-400">Failed to load article.</p>`;
      });
  }

  function nextSentence() {
    if (sentenceIndex < allSentences.length - 1) {
      sentenceIndex++;
      document.getElementById("sentence-view").innerText = allSentences[sentenceIndex];
    }
  }

  function prevSentence() {
    if (sentenceIndex > 0) {
      sentenceIndex--;
      document.getElementById("sentence-view").innerText = allSentences[sentenceIndex];
    }
  }

  function changeFontSize(change) {
    fontSize += change;
    if (fontSize < 12) fontSize = 12;
    if (fontSize > 28) fontSize = 28;
    applyFontSize();
  }

  function applyFontSize() {
    document.getElementById("full-article").style.fontSize = fontSize + "px";
    document.getElementById("sentence-view").style.fontSize = fontSize + "px";
  }

  function toggleView(forceTo = null) {
    const fullEl = document.getElementById("full-article");
    const sentEl = document.getElementById("sentence-view");

    isSentenceMode = forceTo !== null ? forceTo : !isSentenceMode;

    fullEl.style.display = isSentenceMode ? "none" : "block";
    sentEl.style.display = isSentenceMode ? "block" : "none";
  }

  window.onload = onFeedSelect;
</script>

</body>
</html>
