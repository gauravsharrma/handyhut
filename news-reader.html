<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>HandyHut - News Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">

<div id="header-container"></div>

<main class="container mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <h1 class="text-2xl font-bold text-indigo-400 mb-4">üóûÔ∏è News Reader</h1>

  <!-- Filter Controls -->
  <div class="mb-6 flex flex-wrap gap-4 items-center">
    <label class="block">
      <span class="text-sm text-gray-300">Category</span><br />
      <select id="category" class="bg-gray-800 border border-gray-600 p-2 rounded text-white" onchange="onCategoryChange()">
        <option value="toi">Times of India</option>
      </select>
    </label>

    <label class="block">
      <span class="text-sm text-gray-300">Subcategory</span><br />
      <select id="subcategory" class="bg-gray-800 border border-gray-600 p-2 rounded text-white" onchange="onFeedSelect()">
        <option value="top">Top Stories</option>
        <option value="india">India</option>
      </select>
    </label>
  </div>

  <!-- Two-column layout -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Left: List of article descriptions -->
    <section class="bg-gray-800 p-4 rounded-md shadow-md max-h-[75vh] overflow-y-auto">
      <h2 class="text-lg text-yellow-400 font-semibold mb-2">Articles</h2>
      <div id="news-list" class="space-y-4 text-sm"></div>
    </section>

    <!-- Right: Full article content -->
    <section class="bg-gray-800 p-4 rounded-md shadow-md max-h-[75vh] overflow-y-auto">
      <h2 class="text-lg text-indigo-400 font-semibold mb-2">Full Article</h2>
      <div id="full-article" class="text-gray-300 text-sm whitespace-pre-line">Select an article to read.</div>
    </section>
  </div>
</main>

<div id="footer-container"></div>

<script>
  async function loadHeader() {
    const response = await fetch('header.html');
    document.getElementById('header-container').innerHTML = await response.text();
  }

  async function loadFooter() {
    const response = await fetch('footer.html');
    document.getElementById('footer-container').innerHTML = await response.text();
  }

  loadHeader();
  loadFooter();

  const feeds = {
    toi: {
      top: "http://timesofindia.indiatimes.com/rssfeedstopstories.cms",
      india: "http://timesofindia.indiatimes.com/rssfeeds/-2128936835.cms"
    }
  };

  const proxyBase = "https://api.codetabs.com/v1/proxy/?quest=";

  function onCategoryChange() {
    onFeedSelect();
  }

  function onFeedSelect() {
    const category = document.getElementById("category").value;
    const subcategory = document.getElementById("subcategory").value;
    const url = feeds[category][subcategory];
    const proxyURL = proxyBase + encodeURIComponent(url);

    fetch(proxyURL)
      .then(res => res.text())
      .then(text => {
        const xml = new DOMParser().parseFromString(text, "text/xml");
        const items = xml.querySelectorAll("item");
        const list = document.getElementById("news-list");
        list.innerHTML = "";
        document.getElementById("full-article").innerHTML = "Select an article to read.";

        items.forEach((item) => {
          const title = item.querySelector("title").textContent;
          const link = item.querySelector("link").textContent;
          const description = item.querySelector("description").textContent;

          const card = document.createElement("div");
          card.className = "p-3 bg-gray-700 rounded cursor-pointer hover:bg-gray-600";
          card.innerHTML = `<strong class="text-indigo-300">${title}</strong><p class="text-gray-400 mt-1">${description}</p>`;
          card.onclick = () => loadFullArticle(link, title);
          list.appendChild(card);
        });
      })
      .catch(err => {
        console.error("RSS feed load error:", err);
        document.getElementById("news-list").innerHTML = `<p class="text-red-400">Failed to load news.</p>`;
      });
  }

  function loadFullArticle(url, title) {
    const proxyURL = proxyBase + encodeURIComponent(url);

    fetch(proxyURL)
      .then(res => res.text())
      .then(html => {
        const doc = new DOMParser().parseFromString(html, "text/html");
        const textContent = extractMainArticleContent(doc);

        document.getElementById("full-article").innerHTML =
          `<h3 class="text-indigo-300 font-semibold mb-2">${title}</h3><p>${textContent}</p>`;
      })
      .catch(err => {
        console.error("Full article load error:", err);
        document.getElementById("full-article").innerHTML = `<p class="text-red-400">Failed to load article.</p>`;
      });
  }

  function extractMainArticleContent(doc) {
    const divs = Array.from(doc.querySelectorAll("div"));
    const mainDiv = divs
      .map(div => ({
        text: div.innerText.trim(),
        length: div.innerText.trim().split(/\s+/).length
      }))
      .filter(x => x.length > 100)
      .sort((a, b) => b.length - a.length)[0];

    return mainDiv ? mainDiv.text : "Unable to extract main content.";
  }

  window.onload = onFeedSelect;
</script>

</body>
</html>
