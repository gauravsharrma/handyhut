<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extracted Article Text</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Merriweather', serif; /* A good serif font for reading */
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 py-10">
    <div class="container mx-auto bg-white rounded-lg shadow-md p-8 max-w-3xl">
        <div id="article-text" class="text-lg text-gray-800 leading-relaxed text-center">
            Loading article text...
        </div>
    </div>

    <script>
        async function fetchAndExtractArticle() {
            const urlParams = new URLSearchParams(window.location.search);
            const articleUrl = urlParams.get('url');
            const proxyUrl = "https://api.codetabs.com/v1/proxy/?quest=";
            const fullArticleUrl = proxyUrl + encodeURIComponent(articleUrl);
            const articleDiv = document.getElementById('article-text');

            try {
                const response = await fetch(fullArticleUrl);
                if (!response.ok) {
                    articleDiv.textContent = `Failed to fetch article: ${response.status}`;
                    return;
                }
                const articleHTML = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(articleHTML, 'text/html');

                // Attempt to extract the main article content
                const mainDiv = doc.querySelector("div._s30J.clearfix");
                if (mainDiv) {
                    // Remove images from the extracted content
                    const images = mainDiv.querySelectorAll('img');
                    images.forEach(img => img.remove());

                    // Set the extracted content
                    articleDiv.innerHTML = mainDiv.innerHTML;
                } else {
                    console.warn("Main article content selector not found. Displaying full article without specific extraction.");
                    const bodyWithoutImages = doc.body.cloneNode(true);
                    const bodyImages = bodyWithoutImages.querySelectorAll('img');
                    bodyImages.forEach(img => img.remove());
                    articleDiv.innerHTML = bodyWithoutImages.innerHTML;
                    // Or a simpler fallback:
                    // articleDiv.textContent = "Could not extract main article content.";
                }

                // Further style adjustments after content is loaded
                const paragraphs = articleDiv.querySelectorAll('p');
                paragraphs.forEach(p => {
                    p.classList.add('mb-4', 'text-justify'); // Add margin and justify text
                    // Wrap text to limit line length (more robust than CSS alone for dynamic content)
                    p.innerHTML = p.textContent.replace(/([^\s]{120})/g, '$1<wbr>');
                });

                const headings = articleDiv.querySelectorAll('h1, h2, h3, h4, h5, h6');
                headings.forEach(h => {
                    h.classList.add('text-indigo-700', 'font-bold', 'mt-6', 'mb-2', 'text-center');
                });

                // Center all direct text nodes and elements within article-text
                articleDiv.style.textAlign = 'center';
            } catch (error) {
                console.error("Error fetching and extracting article:", error);
                articleDiv.textContent = "Error fetching article.";
            }
        }

        fetchAndExtractArticle();
    </script>
</body>
</html>
